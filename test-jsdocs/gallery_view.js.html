<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: portfolio/gallery_view.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: portfolio/gallery_view.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(
  ['jquery', 'gallery_model', 'messages', 'logger', 'contextual_carousel'],
  /**
* @exports gallery_view



*/
  function($, Model, Messages, Logger, ContextualCarousel) {
    'use strict';
    /** @alias module:gallery_view */
    /** @alias module:gallery_view */
    var exports = {};
    var minDate = '01/01/1999';
    var gigsPanel = null;
    var carousel = null;
    var genrePanels = {};
    var fossilSwitch = null;
    var galleryBuffer = null;
    var fossilTitle = null;
    var filterSettings = {};
    var selectedItems = [];
    var cursorState = 0;
    var galleryData = [];
    var categories = [];
    // initialize tabs
    /**
     * make some kind of control for categories.
     * @param {String} category
     */
    function createCategoryControl(category, active) {
      var decoded = $("&lt;div/>").html(category).text();
      var activeClass = active ? 'active' : '';
      var el = $('&lt;label class="btn btn-lg btn-primary ' + activeClass + '">&lt;input type="radio" name="categories" id="' + category + '">' + decoded + '&lt;/label>');
      el.button();
      el.on('click', function() {
        exports.setCategory(decoded);
      });
      $('#categories').append(el);
    }
    /**
     * general tab button.
     * @param {String} category
     */
    function createTabButton(category, active) {
      var decoded = $("&lt;div/>").html(category).text();
      var activeClass = active ? 'active' : '';
      var el = $('&lt;label class="btn btn-lg btn-primary ' + activeClass + '">&lt;input type="radio" name="categories" id="' + category + '">' + decoded + '&lt;/label>');
      el.button();
      el.on('click', function() {
        exports.setCategory(decoded);
      });
      $('#categories').append(el);
    }
    /**
     * Render.
     * @param data
     */
    exports.render = function(data) {
      galleryData = data.items;
      categories = data.categories;
      // render categories:
      //            for (var c = 0; c &lt; categories.length; c++) {
      //                var category = categories[c];
      //                createCategoryControl(category, (c === 0));
      //            }
      // galleryBuffer is the whole big frame??
      galleryBuffer = $('#galleryBuffer');
      if (carousel === null) {
        carousel = new ContextualCarousel();
        carousel.initialize();
        Messages.observe('gallery_view', carousel, exports);
      }
      var genres = data.genres;
      for (var e in genres) {
        if (genres.hasOwnProperty(e)) {
          var genre = genres[e];
          var panelContainer = createGenrePanel(e, genre);
          genrePanels[e] = panelContainer;
        }
      }
      var fossilSelector =
        '&lt;p class="fossilTitle">Check &lt;span class="thisbox" >&lt;input id="fossils" type="checkbox" class="fossil-checkbox">this box&lt;/span> if you want to see the ancient fossils.&lt;/p>';
      galleryBuffer.html(fossilSelector);
      fossilSwitch = $('#fossils');
      fossilTitle = $('.fossilTitle');
      var fossils = fossilSwitch.is(':checked');
      if (fossils) {
        minDate = '01/01/1989';
      } else {
        minDate = '01/01/2000';
      }
      filterItems(minDate, '*', 'Enterprise', '*');
      displayGenrePanels();
      galleryBuffer.detach();
      gigsPanel = $('#gigs');
      gigsPanel.empty();
      gigsPanel.append(galleryBuffer);
      gigsPanel.append(carousel.element);
      // galleryBuffer.show();
      /**
       * Handler in.
       * @param eventObject
       */
      $('.gallery-item').hover(function handlerIn(eventObject) {
        var pair = $(this).attr('id');
        var index = parseInt(pair.split(',')[0], 10);
        var item = galleryData[index];
        var industry = item.industry;
        /**
         * Handler out.
         * @param eventObject
         */
      }, function handlerOut(eventObject) {
        var pair = $(this).attr('id');
        var index = parseInt(pair.split(',')[0], 10);
        var item = galleryData[index];
        var industry = item.industry;
      });
      $('.gallery-item').on('click', function(evt) {
        exports.showItem($(this));
      });
      $('#fossils').on('click', function(evt) {
        exports.showFossils();
      });
      gigsPanel.show();
      carousel.show();
      carousel.render(data);
    };
    /**
     * Pad title.
     * @param {String}
     * @return {String}
     */
    function padTitle(input) {
      return input.split(' ').join('_').split('/').join('_');
    }
    /**
     * Create genre panel.
     * @param genreTitle
     * @param genreItems
     * @return {Object}
     */
    function createGenrePanel(genreTitle, genreItems) {
      Logger.fine('createGenrePanel: ' + genreTitle);
      var panelContainer = {};
      var newPanel = document.createElement('div');
      newPanel.className = 'container';
      newPanel.id = genreTitle;
      var title = document.createElement('h2');
      title.id = 'title_' + padTitle(genreTitle);
      title.innerHTML = genreTitle;
      newPanel.appendChild(title);
      for (var index = 0; index &lt; genreItems.length; index++) {
        var item = genreItems[index];
        item.gallerItem = createGalleryItem(item, index);
        newPanel.appendChild(item.gallerItem.element);
      }
      panelContainer.panel = newPanel;
      panelContainer.genreItems = genreItems;
      return panelContainer;
    }
    /**
     * Create gallery item.
     * @param item
     * @param index
     * @return {Object}
     */
    function createGalleryItem(item, index) {
      Logger.fine('createGalleryItem: ' + index);
      item.slideSources = [];
      item.slideThumbs = [];
      item.slideInstances = [];
      var id = 'slide_' + index;
      var itemWrapper = document.createElement('span');
      itemWrapper.className = 'gallery-flow';
      itemWrapper.id = id;
      for (var whichSlide = 0; whichSlide &lt; item.slides.length; whichSlide++) {
        var slide = createGallerySlide(item, whichSlide);
        itemWrapper.appendChild(slide);
      }
      item.element = itemWrapper;
      return item;
    }
    /**
     * Create gallery slide.
     * @param item
     * @param index
     * @return {Object} A jQuery element.
     */
    function createGallerySlide(item, index) {
      var label = item.date + ': &lt;br />' + item.client;
      Logger.fine('createGallerySlide: ' + label);
      var slideName = item.slides[index];
      var venue = item.slideRoot;
      var prefix = item.prefix;
      item.slideThumbs[index] = 'images/thumbnails/' + venue + '/' + prefix + slideName;
      item.slideSources[index] = 'images/projects/' + venue + '/' + prefix + slideName;
      var wrapper = document.createElement('span');
      wrapper.className = 'slide-wrapper';
      var titleDate = document.createElement('span');
      titleDate.innerHTML = item.date;
      titleDate.className = 'slide-title-date';
      var title = document.createElement('span');
      title.className = 'slide-title';
      title.innerHTML = item.client + ' (' + new Date(item.date).getUTCFullYear() + ')';
      var slide = document.createElement('img');
      $(slide).data('bigSrc', item.slideSources[index]);
      slide.id = item.index + '_' + index;
      slide.className = 'gallery-item';
      slide.alt = label;
      wrapper.appendChild(title);
      wrapper.appendChild($('&lt;br />')[0]);
      wrapper.appendChild(slide);
      $(wrapper).data('bigSrc', item.slideSources[index]);
      item.slideInstances.push(wrapper);
      return wrapper;
    }
    /**
     * Display genre panels.
     */
    function displayGenrePanels() {
      Logger.fine('displayGenrePanels()');
      for (var g in genrePanels) {
        if (genrePanels.hasOwnProperty(g)) {
          var genrePanel = genrePanels[g];
          galleryBuffer.append($(genrePanel.panel));
        }
      }
    }
    /**
     * Filter genre panels.
     */
    function filterGenrePanels() {
      Logger.fine('filterGenrePanels()');
      var hasFossils = false;
      for (var g in genrePanels) {
        if (genrePanels.hasOwnProperty(g)) {
          var genrePanel = genrePanels[g];
          var items = genrePanel.genreItems;
          var show = false;
          for (var index = 0; index &lt; items.length; index++) {
            var item = items[index];
            if (item.matchedExceptDate &amp;&amp; item.ancient) {
              hasFossils = true;
            }
            if (item.show) {
              show = true;
            }
          }
          if (show) {
            genrePanel.panel.style.display = 'block';
          } else {
            genrePanel.panel.style.display = 'none';
          }
        }
      }
      if (hasFossils) {
        fossilTitle.show();
      } else {
        fossilTitle.hide();
      }
    }
    /**
     * Filter items.
     * @param date
     * @param industry
     * @param tabCategory
     * @param genre
     */
    function filterItems(date, industry, tabCategory, genre) {
      var ancientDate = new Date('01/01/1999').getTime();
      if (date == null) {
        date = filterSettings.date;
      } else {
        filterSettings.date = date;
      }
      if (industry == null) {
        industry = filterSettings.industry;
      } else {
        filterSettings.industry = industry;
      }
      if (tabCategory == null) {
        tabCategory = filterSettings.tabCategory;
      } else {
        filterSettings.tabCategory = tabCategory;
      }
      if (genre == null) {
        genre = filterSettings.genre;
      } else {
        filterSettings.genre = genre;
      }
      Logger.fine('filterItems: ' + date + ',' + industry + ',' + tabCategory + ',' + genre);
      var theCurrentDate = new Date(date).getTime();
      for (var index = 0; index &lt; galleryData.length; index++) {
        var item = galleryData[index];
        var fossilDate = new Date(item.date).getTime();
        var show = false;
        var dateGood = false;
        var genreGood = false;
        var industryGood = false;
        var categoryGood = false;
        if (item.industry === industry || industry === '*') {
          industryGood = true;
        }
        if (item.tabCategory === tabCategory || tabCategory === '*') {
          categoryGood = true;
        }
        if (item.genre === genre || genre === '*') {
          genreGood = true;
        }
        item.matchedExceptDate = false;
        if (genreGood &amp;&amp; categoryGood &amp;&amp; industryGood) {
          item.matchedExceptDate = true;
        }
        item.ancient = false;
        if (fossilDate &lt; ancientDate) {
          item.ancient = true;
        }
        if (fossilDate > theCurrentDate || date === '*') {
          dateGood = true;
        }
        if (dateGood &amp;&amp; genreGood &amp;&amp; categoryGood &amp;&amp; industryGood) {
          show = true;
        }
        item.show = show;
        for (var whichSlide = 0; whichSlide &lt; item.slides.length; whichSlide++) {
          var slide = item.slideInstances[whichSlide];
          var img = $(slide).find('.gallery-item');
          img = $(img);
          img.data('smallSrc', item.slideThumbs[whichSlide]);
          img.data('bigSrc', item.slideSources[whichSlide]);
          if (show &amp;&amp; whichSlide === 0) {
            busyCursor();
            $(img).on('load', normalCursor);
            img.attr('src', item.slideThumbs[whichSlide]);
            slide.style.display = 'inline-block';
            Logger.fine(item.slideSources[whichSlide]);
          } else {
            slide.style.display = 'none';
          }
        }
      }
      filterGenrePanels();
    }
    /**
     * Show popup.
     * @param item
     * @param slideIndex
     */
    exports.showPopup = function(item, slideIndex) {
      galleryBuffer.hide();
      carousel.render(item, slideIndex);
    };
    /**
     * Cache all images.
     */
    function cacheAllImages() {
      var imgs = $('.gallery-item');
      for (var index = 0; index &lt; imgs.length; index++) {
        var img = $(imgs[index]);
        var smallSrc = img.data('smallSrc');
        if (smallSrc != null) {
          Logger.fine('cache image "' + smallSrc + '"');
          img.attr('src', smallSrc);
        } else {
          Logger.fine('can\'t cache image ' + index + ' because smallSrc is null');
        }
      }
    }
    /**
     * Busy cursor.
     */
    function busyCursor() {
      //$('html').css('cursor', 'progress');
      cursorState++;
      // Logger.fine('busyCursor: ' + cursorState);
      if (cursorState > 2) {
        cursorState = 2;
      }
    }
    /**
     * Normal cursor.
     */
    function normalCursor() {
      cursorState--;
      if (cursorState &lt; 1) {
        cursorState = 0;
        //$('html').css('cursor', 'auto');
      }
      // Logger.fine('normalCursor: ' + cursorState);
    }
    // / Factored Code:
    /**
     * Set category.
     * @param value
     * @param ui
     */
    exports.setCategory = function(value) {
      Logger.fine('setCategory("' + value + '")');
      var fossils = fossilSwitch.is(':checked');
      if (fossils) {
        minDate = '01/01/1989';
      } else {
        minDate = '01/01/1999';
      }
      filterItems(minDate, '*', value, '*');
      //gigsPanel.empty();
      //gigsPanel.append(galleryBuffer);
      //gigsPanel.append(carousel.element);
      // carousel.hide();
      // galleryBuffer.show();
    };
    /**
     * Go back.
     */
    exports.goBack = function() {
      Logger.fine('goBack()');
      // carousel.hide();
      // galleryBuffer.show();
    };
    /**
     * Show item.
     * @param itemJQElement
     */
    exports.showItem = function(itemJQElement) {
      Logger.fine('showItem()');
      var pair = itemJQElement.attr('id');
      var index = parseInt(pair.split(',')[0], 10);
      exports.showPopup(galleryData[index], 0);
    };
    /**
     * Show fossils.
     */
    exports.showFossils = function() {
      Logger.fine('showFossils()');
      var fossils = fossilSwitch.is(':checked');
      Logger.fine('fossils = ' + fossils);
      if (fossils) {
        minDate = '01/01/1989';
      } else {
        minDate = '01/01/1999';
      }
      filterItems(minDate);
    };
    /**
     * Load big slide.
     * @param thumbNailElement
     */
    exports.loadBigSlide = function(bigSrc) {
      busyCursor();
      Logger.fine('loadBigSlide: ' + bigSrc);
      // slide_panel
      $('.big-picture-img').on('load', normalCursor);
      $('.big-picture-img').attr('src', bigSrc);
    };
    // Public API
    /**
     * Update.
     * @param observation
     * @param data
     */
    exports.update = function(observation, data) {
      if (observation.what === 'gallery-model') {
        exports.render(data);
        exports.setCategory(data.categories[0]);
        //            } else if (observation.what === 'gallery-view-category') {
        //                //??
        //            } else if (observation.what === 'gallery-view-item') {
        //                //??
        //            } else if (observation.what === 'gallery-view-fossils') {
        //                //??
        //            } else if (observation.what === 'gallery-view-goback') {
        //                //??
      } else if (observation.what === 'gallery_view') {
        // alert(JSON.stringify(data));
        if (data.control != null) {
          var controlData = null;
          if (data.data != null) {
            controlData = data.data;
          }
          exports[data.control](controlData);
        }
      }
    };
    Messages.observe('gallery-model', Model, exports);
    return exports;
  });</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-accountDetailsHeader.html">accountDetailsHeader</a></li><li><a href="module-browser_detect.html">browser_detect</a></li><li><a href="module-context.html">context</a></li><li><a href="module-depositAccounts.html">depositAccounts</a></li><li><a href="module-gallery_dao.html">gallery_dao</a></li><li><a href="module-gallery_model.html">gallery_model</a></li><li><a href="module-gallery_view.html">gallery_view</a></li><li><a href="module-info_panel.html">info_panel</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-messages.html">messages</a></li><li><a href="module-panel.html">panel</a></li><li><a href="contextual_carousel.html">portfolio/contextual_carousel</a></li><li><a href="module-slide_panel.html">slide_panel</a></li><li><a href="module-tab_panel.html">tab_panel</a></li><li><a href="module-tabs.html">tabs</a></li><li><a href="module-test.html">test</a></li><li><a href="module-thumbnail_panel.html">thumbnail_panel</a></li><li><a href="module-zero-test.html">zero-test</a></li></ul><h3>Classes</h3><ul><li><a href="module-accountDetailsHeader-AccountDetailsHeaderView.html">AccountDetailsHeaderView</a></li><li><a href="module-browser_detect-BrowserDetect.html">BrowserDetect</a></li><li><a href="context.html">module:fluffy/context</a></li><li><a href="context_ChildContext.html">ChildContext</a></li><li><a href="module-info_panel-InfoPanel.html">InfoPanel</a></li><li><a href="module-panel-Panel.html">Panel</a></li><li><a href="contextual_carousel-ContextualCarousel.html">ContextualCarousel</a></li><li><a href="module-slide_panel-SlidePanel.html">SlidePanel</a></li><li><a href="module-tab_panel-TabPanel.html">TabPanel</a></li><li><a href="module-tabs-Tabs.html">Tabs</a></li><li><a href="module-test-FifthClass.html">FifthClass</a></li><li><a href="module-test-FourthClass.html">FourthClass</a></li><li><a href="module-test-Freenox.html">Freenox</a></li><li><a href="module-test-SecondClass.html">SecondClass</a></li><li><a href="module-test-ThirdClass.html">ThirdClass</a></li><li><a href="module-thumbnail_panel-ThumbnailPanel.html">ThumbnailPanel</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Tue Nov 11 2014 18:40:40 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
