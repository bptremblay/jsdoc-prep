<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js/component/logon.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: js/component/logon.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(
  /**
   * @exports js/component/logon
   */
  function(require) {
    var cookieMgr = require('logon/shared/cookieManager'),
      authClient = require('logon/shared/authClientApi'),
      is = require('blue/is'),
      userIdRegEx = /^[A-Za-z0-9_]+$/,
      logger;
    return {
      /**
       * Init.
       */
      init: function() {
        logger = this.context.logger;
        var userIdValue = cookieMgr.readCookie(this.settings.context.settings.get('usernameCookieName')),
          defaultPlaceholder = this.model.get().user_id_placeholder;
        this.rememberedUserId = userIdValue !== null &amp;&amp; userIdValue.length > 0 ? userIdValue : null;
        this.rememberMyUserId = userIdValue.length > 0;
        this.model.lens('tmp_user_id_placeholder').set(defaultPlaceholder);
        if (this.rememberedUserId !== null) {
          this.model.get().user_id_placeholder = authClient.mask(this.rememberedUserId);
        }
        //Update temp rememberme cookie
        this.selectRememberMyUserId();
      },
      /**
       * Logon to landing page.
       *
       */
      logonToLandingPage: function() {
        logger.debug('===== logonToLandingPage =====');
        var id = (this.userId !== null &amp;&amp; this.userId !== '') ? this.userId : this.rememberedUserId;
        if (!this.validate(id)) {
          this.setStatus('inv');
          this.resetForm();
          return;
        }
        //Storing submitted user id in session for use in MFA flow.  (Independent of remember-me option)
        this.context.controller.sessionStore.set('tempId', id);
        authClient.lob = this.context.controller.settings.get('authLOB');
        authClient.siteId = envConfig.config.authSiteId || this.context.controller.settings.get('defaultAuthSiteId');
        authClient.userId = id;
        authClient.password = this.password;
        authClient.authenticate();
      },
      /**
       * Select remember my user id.
       */
      selectRememberMyUserId: function() {
        //TODO: resolve domain
        cookieMgr.writeCookie(this.getSetting('rememberMeCookieName'), this.rememberMyUserId ? '1' : '0');
      },
      /**
       * Reset form.
       */
      resetForm: function() {
        this.password = '';
        this.userId = '';
        this.rememberedUserId = '';
        this.rememberMyUserId = 0;
        cookieMgr.writeCookie(this.context.controller.settings.get('usernameCookieName'), '', '.chase.com');
        this.selectRememberMyUserId();
        this.output.emit('state', {
          target: this,
          value: 'resetform',
          placeholder: this.model.get().tmp_user_id_placeholder
        });
      },
      /**
       * Set status.
       * @param code
       */
      setStatus: function(code) {
        var loginFailureCountModel = this.model.lens('loginFailureCount'),
          count = loginFailureCountModel.get();
        if ('number' === typeof count || count instanceof Number) {
          count++;
        } else {
          count = 1;
        }
        loginFailureCountModel.set(count);
        // show call 'call center' message if errorCount > 5
        if (count > this.getSetting('maxLoginFailureCount')) {
          code = 'loc';
        }
        this.output.emit('state', {
          target: this,
          value: 'valid',
          msgData: this.getErrorMessage(code)
        });
      },
      /**
       * Validate.
       * @param id
       * @todo Please describe the return type of this method.
       */
      validate: function(id) {
        return userIdRegEx.test(id);
      },
      /**
       * Forgot password.
       */
      forgotPassword: function() {
        this.context.logger.debug('===== forgotPassword =====');
        this.context.controller.state('logon/forgot-password');
      },
      /**
       * Get setting.
       * @param name
       * @todo Please describe the return type of this method.
       */
      getSetting: function(name) {
        return this.settings.context.settings.get(name);
      },
      /**
       * Get error message.
       * @param errorCode
       * @return msg
       */
      getErrorMessage: function(errorCode) {
        var msg = null,
          content = this.context.controller.dynamicContentUtil;
        if (is.string(errorCode)) {
          content.dynamicSettings.set(this, 'logon_to_landing_page_error', errorCode.toLowerCase());
          msg = this.model.get().logon_to_landing_page_error;
        }
        if (!msg || msg === '') {
          // Try to get a default.
          content.dynamicSettings.set(this, 'logon_to_landing_page_error', 'inv');
          msg = this.model.get().logon_to_landing_page_error;
        }
        return msg;
      }
    };
  });</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li></li><li><a href="module-accountDetailsHeader.html">accountDetailsHeader</a></li><li><a href="module-depositAccounts.html">depositAccounts</a></li><li><a href="module-IndexController.html">IndexController</a></li><li><a href="logon.html">js/component/logon</a></li><li><a href="logonIdentification.html">js/component/logonIdentification</a></li><li><a href="logonPasswordReset.html">js/component/logonPasswordReset</a></li><li><a href="topMenu.html">js/component/topMenu</a></li><li><a href="logon_.html">js/controller/logon</a></li><li><a href="menu.html">js/controller/menu</a></li><li><a href="mfa.html">js/controller/mfa</a></li><li><a href="passwordReset.html">js/controller/passwordReset</a></li><li><a href="scenario.html">js/controller/scenario</a></li><li><a href="auth.html">js/service/auth</a></li><li><a href="request.html">js/service/interceptor/request</a></li><li><a href="otp.html">js/service/otp</a></li><li><a href="settings.html">js/settings</a></li><li><a href="authClientApi.html">js/shared/authClientApi</a></li><li><a href="cookieManager.html">js/shared/cookieManager</a></li><li><a href="otpClient.html">js/shared/otpClient</a></li><li><a href="storeLens.html">js/shared/storeLens</a></li><li><a href="topMenu_.html">js/spec/topMenu</a></li><li><a href="logon__.html">js/view/logon</a></li><li><a href="logonPasswordReset_.html">js/view/logonPasswordReset</a></li><li><a href="logonUserIdFound.html">js/view/logonUserIdFound</a></li><li><a href="menu_.html">js/view/menu</a></li><li><a href="mfa_.html">js/view/mfa</a></li><li><a href="mfaOptions.html">js/view/mfaOptions</a></li><li><a href="mfaSubmit.html">js/view/mfaSubmit</a></li><li><a href="scenario_.html">js/view/scenario</a></li><li><a href="success.html">js/view/success</a></li><li><a href="module-logonPasswordReset.html">logonPasswordReset</a></li><li><a href="module-LogonView.html">LogonView</a></li><li><a href="module-MenuView.html">MenuView</a></li><li><a href="module-MFAView.html">MFAView</a></li><li><a href="module-MockView.html">MockView</a></li><li><a href="module-test.html">test</a></li><li></li></ul><h3>Classes</h3><ul><li><a href="module-test.html#FourthClass">FourthClass</a></li><li><a href="module-test-Freenox.html">Freenox</a></li><li><a href="module-test-SecondClass.html">SecondClass</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Mon Nov 03 2014 15:24:05 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
