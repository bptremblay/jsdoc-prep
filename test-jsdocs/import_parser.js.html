<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: import/parser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: import/parser.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(['column-and-block-layout-editor-path/constants'],
  /**
   * @exports src/import/parser
   * @requires column-and-block-layout-editor-path/constants
   */
  function (constants) {
    /**
     * The aTTRS.
     */
    var ATTRS, Parser, childContentEditorExclusionFilter, columnChildExclusionFilter, columnExclusionFilter, contentChildExclusionFilter;
    ATTRS = {
      layout: {
        name: 'data-layout-name',
        type: 'data-layout-type',
        dataType: 'data-layout-data-type',
        included: 'data-layout-included',
        protoLayout: 'data-gl-proto-layout',
        formattingElement: 'data-gl-format-element'
      },
      column: {
        identifier: 'data-layout-column'
      },
      block: {
        identifier: 'data-gl-layout-block'
      },
      contentEditor: {
        identifier: 'data-editor-type',
        name: 'data-editor-name',
        type: 'data-editor-type',
        contentDecorator: 'data-gl-content-decorator'
      },
      childContentEditor: {
        identifier: 'data-gl-nest-child-content'
      },
      formatting: {
        width: 'width',
        align: 'align',
        valign: 'valign',
        style: 'style',
        "class": 'class',
        backgroundColor: 'background-color'
      }
    };
    /**
     * @todo Add some jsDoc comments here!
     */
    contentChildExclusionFilter = function () {
      return $(this).parents("[" + ATTRS.contentEditor.identifier + "]").length === 0;
    };
    /**
     * @todo Add some jsDoc comments here!
     */
    childContentEditorExclusionFilter = function () {
      return $(this).parents("[" + ATTRS.childContentEditor.identifier + "]").length === 0;
    };
    /**
     * @todo Add some jsDoc comments here!
     */
    columnChildExclusionFilter = function () {
      return $(this).parents("[" + ATTRS.column.identifier + "]").length === 0;
    };
    /**
     * @return {Boolean}
     */
    columnExclusionFilter = function () {
      /**
       * The $this.
       */
      var $this;
      $this = $(this);
      return !$this.is("[" + ATTRS.column.identifier + "]") &amp;&amp; $this.parents("[" + ATTRS.column.identifier + "]").length === 0;
    };
    return Parser = ( /**@lends module:src/import/parser~Parser# */ function () {
      /**
       * @constructor
       * @param $markup1
       * @param actualCreate
       */
      function Parser($markup1, actualCreate) {
        this.$markup = $markup1;
        this.actualCreate = actualCreate != null ? actualCreate : false;
      }
      /**
       * @param $content
       */
      Parser.prototype._determine$ContentDecoratorElement = function ($content) {
        /**
         * The $el.
         */
        var $el, untilSelector;
        if ($content.parents("[" + ATTRS.childContentEditor.identifier + "]").length) {
          untilSelector = "[" + ATTRS.childContentEditor.identifier + "]";
        } else if ($content.parents("[" + ATTRS.block.identifier + "]").length) {
          untilSelector = "[" + ATTRS.block.identifier + "]";
        } else {
          untilSelector = "[" + ATTRS.column.identifier + "]";
        }
        $el = $content.parentsUntil(untilSelector).last();
        if ($el.length === 0) {
          return $content;
        } else {
          return $el;
        }
      };
      /**
       * @param $markup
       * @param substate
       * @param filter
       */
      Parser.prototype._parseFormattingAttrs = function ($markup, substate, filter) {
        /**
         * The $formatting elements.
         */
        var $formattingElements;
        $formattingElements = $("[" + ATTRS.layout.formattingElement + "]", $markup).addBack("[" + ATTRS.layout.formattingElement + "]");
        if (filter) {
          $formattingElements = $formattingElements.filter(filter);
        }
        return $formattingElements.each(function () {
          /**
           * The $this.
           */
          var $this, attr, baseName, ref, suffix, value;
          $this = $(this);
          suffix = $this.attr(ATTRS.layout.formattingElement);
          ref = ATTRS.formatting;
          for (baseName in ref) {
            attr = ref[baseName];
            value = $this.attr(attr);
            if (value) {
              substate["" + baseName + suffix] = value;
            }
          }
          return true;
        });
      };
      /**
       * @param $content
       */
      Parser.prototype._parseContent = function ($content) {
        /**
         * The $child content.
         */
        var $childContent, $contentDecoratorElement, content;
        content = {
          name: $content.attr(ATTRS.contentEditor.name),
          type: $content.attr(ATTRS.contentEditor.type),
          actualCreate: this.actualCreate
        };
        $contentDecoratorElement = this._determine$ContentDecoratorElement($content);
        if ($contentDecoratorElement.hasClass(constants.CLASSES.CONTENT_VSPACE)) {
          content.vspace = true;
          $contentDecoratorElement.removeClass(constants.CLASSES.CONTENT_VSPACE);
        }
        $childContent = $contentDecoratorElement.find('[data-gl-nest-child-content] [data-editor-type]');
        if ($childContent.length) {
          content.child = this._parseChildContent($childContent);
        }
        this._parseFormattingAttrs(this._determine$ContentDecoratorElement($content), content, childContentEditorExclusionFilter);
        return content;
      };
      /**
       * @param $content
       */
      Parser.prototype._parseChildContent = function ($content) {
        /**
         * The $child content.
         */
        var $childContent, $contentDecoratorElement, childContent;
        childContent = {
          name: $content.attr(ATTRS.contentEditor.name),
          type: $content.attr(ATTRS.contentEditor.type),
          decoratorType: $content.attr(ATTRS.contentEditor.contentDecorator)
        };
        $contentDecoratorElement = this._determine$ContentDecoratorElement($content);
        $childContent = $contentDecoratorElement.find('[data-gl-nest-child-content] [data-editor-type]');
        this._parseFormattingAttrs(this._determine$ContentDecoratorElement($content), childContent, contentChildExclusionFilter);
        return childContent;
      };
      /**
       * @param $block
       */
      Parser.prototype._parseContents = function ($block) {
        /**
         * The selector.
         */
        var selector;
        selector = "[" + ATTRS.contentEditor.identifier + "]";
        return $block.find(selector).addBack(selector).map((function (_this) {
          return function (idx, el) {
            if (!($(el).parents('[data-gl-nest-child-content]').length > 0)) {
              return _this._parseContent($(el));
            }
          };
        })(this)).get();
      };
      /**
       * @param $block
       */
      Parser.prototype._parseBlock = function ($block) {
        /**
         * The contents.
         */
        var contents;
        contents = this._parseContents($block);
        return {
          id: contents[0].name,
          contents: contents
        };
      };
      /**
       * @param $column
       */
      Parser.prototype._parseBlocks = function ($column) {
        /**
         * The block selector.
         */
        var blockSelector, contentEditorSelector, selector;
        blockSelector = "[" + ATTRS.block.identifier + "]";
        contentEditorSelector = "[" + ATTRS.contentEditor.identifier + "]";
        selector = contentEditorSelector;
        if ($column.find(blockSelector).length !== 0) {
          selector = blockSelector;
        }
        return $(selector, $column).map((function (_this) {
          return function (idx, el) {
            if (!($(el).parents('[data-gl-nest-child-content]').length > 0)) {
              return _this._parseBlock($(el));
            }
          };
        })(this)).get();
      };
      /**
       * @param $column
       * @param columnCount
       */
      Parser.prototype._parseColumn = function ($column, columnCount) {
        /**
         * The column.
         */
        var column, defaultPercentage;
        defaultPercentage = 1 / columnCount;
        column = {};
        this._parseFormattingAttrs($column, column, columnChildExclusionFilter);
        column.columnWidth = this._parseColumnWidth($column, defaultPercentage);
        column.blocks = this._parseBlocks($column);
        return column;
      };
      /**
       * @param $column
       * @param defaultPercentage
       * @return {Boolean}
       */
      Parser.prototype._parseColumnWidth = function ($column, defaultPercentage) {
        /**
         * The number read from column.
         */
        var numberReadFromColumn, specifiedPercentage;
        numberReadFromColumn = parseInt($column.attr(ATTRS.column.identifier), 10);
        specifiedPercentage = numberReadFromColumn / 100;
        return specifiedPercentage || defaultPercentage;
      };
      /**
       * @param $markup
       */
      Parser.prototype._parseColumns = function ($markup) {
        /**
         * The $columns.
         */
        var $columns;
        $columns = $("[" + ATTRS.column.identifier + "]", $markup);
        return $columns.map((function (_this) {
          return function (idx, el) {
            return _this._parseColumn($(el), $columns.length);
          };
        })(this)).get();
      };
      /**
       * @param $markup
       * @param state
       * @return {Object} AssignmentExpression
       */
      Parser.prototype._parseAttrs = function ($markup, state) {
        state.name = $markup.attr(ATTRS.layout.name);
        state.type = $markup.attr(ATTRS.layout.type);
        state.dataType = $markup.attr(ATTRS.layout.dataType);
        state.included = $markup.attr(ATTRS.layout.included || null);
        return state.protoLayout = $markup.attr(ATTRS.layout.protoLayout);
      };
      /**
       * @return {Object} AssignmentExpression
       */
      Parser.prototype._parse = function () {
        this._parseAttrs(this.$markup, this.state);
        this._parseFormattingAttrs(this.$markup, this.state, columnExclusionFilter);
        return this.state.columns = this._parseColumns(this.$markup);
      };
      /**
       * @todo Add some jsDoc comments here!
       */
      Parser.prototype.toState = function () {
        this.state = {
          columns: []
        };
        this._parse();
        return this.state;
      };
      return Parser;
    })();
  });</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-src_abstract-layout-generator.html">src/abstract-layout-generator</a></li><li><a href="module-src_column-and-block-layout-editor.html">src/column-and-block-layout-editor</a></li><li><a href="module-src_column-resize-manager.html">src/column-resize-manager</a></li><li><a href="module-src_constants.html">src/constants</a></li><li><a href="module-src_drag-drop_api.html">src/drag-drop/api</a></li><li><a href="module-src_drag-drop_block.html">src/drag-drop/block</a></li><li><a href="module-src_drag-drop_block-model-dispatcher.html">src/drag-drop/block-model-dispatcher</a></li><li><a href="module-src_drag-drop_blocks.html">src/drag-drop/blocks</a></li><li><a href="module-src_drag-drop_column.html">src/drag-drop/column</a></li><li><a href="module-src_drag-drop_columns.html">src/drag-drop/columns</a></li><li><a href="module-src_drag-drop_helpers.html">src/drag-drop/helpers</a></li><li><a href="module-src_drag-drop_insert-marker.html">src/drag-drop/insert-marker</a></li><li><a href="module-src_drag-drop_layout.html">src/drag-drop/layout</a></li><li><a href="module-src_import_importer.html">src/import/importer</a></li><li><a href="module-src_import_parser.html">src/import/parser</a></li><li><a href="module-src_index.html">src/index</a></li><li><a href="module-src_models_block.html">src/models/block</a></li><li><a href="module-src_models_blocks.html">src/models/blocks</a></li><li><a href="module-src_models_column.html">src/models/column</a></li><li><a href="module-src_models_columns.html">src/models/columns</a></li><li><a href="module-src_models_content.html">src/models/content</a></li><li><a href="module-src_models_content-editor-state-map.html">src/models/content-editor-state-map</a></li><li><a href="module-src_models_content-editors.html">src/models/content-editors</a></li><li><a href="module-src_models_contents.html">src/models/contents</a></li><li><a href="module-src_models_converters_block-converter.html">src/models/converters/block-converter</a></li><li><a href="module-src_models_converters_block-descriptor-to-block.html">src/models/converters/block-descriptor-to-block</a></li><li><a href="module-src_models_converters_block-descriptor-to-content-json.html">src/models/converters/block-descriptor-to-content-json</a></li><li><a href="module-src_models_converters_content-converter.html">src/models/converters/content-converter</a></li><li><a href="module-src_models_converters_content-to-block.html">src/models/converters/content-to-block</a></li><li><a href="module-src_models_converters_content-to-content-json.html">src/models/converters/content-to-content-json</a></li><li><a href="module-src_models_layout.html">src/models/layout</a></li><li><a href="module-src_nls_column-and-block-layout-editor.html">src/nls/column-and-block-layout-editor</a></li><li><a href="module-src_padding_calculator.html">src/padding/calculator</a></li><li><a href="module-src_padding_parser.html">src/padding/parser</a></li><li><a href="module-src_padding_renderer.html">src/padding/renderer</a></li><li><a href="module-src_percentage-utils.html">src/percentage-utils</a></li><li><a href="module-src_state-migrations.html">src/state-migrations</a></li><li><a href="module-src_state-validator.html">src/state-validator</a></li><li><a href="module-src_views_block.html">src/views/block</a></li><li><a href="module-src_views_column.html">src/views/column</a></li><li><a href="module-src_views_column-resize-handle.html">src/views/column-resize-handle</a></li><li><a href="module-src_views_column-resize-handle-IE.html">src/views/column-resize-handle-IE</a></li><li><a href="module-src_views_content.html">src/views/content</a></li><li><a href="module-src_views_import.html">src/views/import</a></li><li><a href="module-src_views_layout.html">src/views/layout</a></li><li><a href="module-src_views_move-handle.html">src/views/move-handle</a></li><li><a href="module-src_views_publish.html">src/views/publish</a></li><li><a href="module-src_views_vspace-flyout.html">src/views/vspace-flyout</a></li></ul><h3>Classes</h3><ul><li><a href="module-src_abstract-layout-generator-AbstractLayoutGenerator_-AbstractLayoutGenerator.html">AbstractLayoutGenerator</a></li><li><a href="module-src_column-resize-manager-=_-ColumnResizeManager.html">ColumnResizeManager</a></li><li><a href="module-src_drag-drop_api-DragDropApi_-DragDropApi.html">DragDropApi</a></li><li><a href="module-src_drag-drop_block-model-dispatcher-BlockModelDispatcher_-BlockModelDispatcher.html">BlockModelDispatcher</a></li><li><a href="module-src_drag-drop_blocks-DragDropBlocks_-DragDropBlocks.html">DragDropBlocks</a></li><li><a href="module-src_drag-drop_block-DragDropBlock_-DragDropBlock.html">DragDropBlock</a></li><li><a href="module-src_drag-drop_columns-DragDropColumns_-DragDropColumns.html">DragDropColumns</a></li><li><a href="module-src_drag-drop_column-DragDropColumn_-DragDropColumn.html">DragDropColumn</a></li><li><a href="module-src_drag-drop_insert-marker-InsertionMarker_-InsertionMarker.html">InsertionMarker</a></li><li><a href="module-src_drag-drop_layout-DragDropLayout_-DragDropLayout.html">DragDropLayout</a></li><li><a href="module-src_import_importer-=_-Importer.html">Importer</a></li><li><a href="module-src_import_parser-Parser_-Parser.html">Parser</a></li><li><a href="module-src_index-ColumnAndBlockLayoutEditor_-ColumnAndBlockLayoutEditor.html">ColumnAndBlockLayoutEditor</a></li><li><a href="module-src_models_blocks-Blocks_-Blocks.html">Blocks</a></li><li><a href="module-src_models_block-BlockModel_-BlockModel.html">BlockModel</a></li><li><a href="module-src_models_columns-Columns_-Columns.html">Columns</a></li><li><a href="module-src_models_column-ColumnModel_-ColumnModel.html">ColumnModel</a></li><li><a href="module-src_models_content-editor-state-map-ContentEditorStateMap_-ContentEditorStateMap.html">ContentEditorStateMap</a></li><li><a href="module-src_models_content-editors-ContentEditors_-ContentEditors.html">ContentEditors</a></li><li><a href="module-src_models_contents-Contents_-Contents.html">Contents</a></li><li><a href="module-src_models_content-ContentModel_-ContentModel.html">ContentModel</a></li><li><a href="module-src_models_converters_block-converter-BlockConverter_-BlockConverter.html">BlockConverter</a></li><li><a href="module-src_models_converters_block-descriptor-to-block-BlockDescriptorToBlock_-BlockDescriptorToBlock.html">BlockDescriptorToBlock</a></li><li><a href="module-src_models_converters_block-descriptor-to-content-json-BlockDescriptorToContent_-BlockDescriptorToContent.html">BlockDescriptorToContent</a></li><li><a href="module-src_models_converters_content-converter-ContentConverter_-ContentConverter.html">ContentConverter</a></li><li><a href="module-src_models_converters_content-to-block-ContentToBlock_-ContentToBlock.html">ContentToBlock</a></li><li><a href="module-src_models_converters_content-to-content-json-ContentToContentJson_-ContentToContentJson.html">ContentToContentJson</a></li><li><a href="module-src_models_layout-LayoutModel_-LayoutModel.html">LayoutModel</a></li><li><a href="module-src_padding_calculator-PaddingCalculator_-PaddingCalculator.html">PaddingCalculator</a></li><li><a href="module-src_padding_parser-PaddingParser_-PaddingParser.html">PaddingParser</a></li><li><a href="module-src_padding_renderer-PaddingRenderer_-PaddingRenderer.html">PaddingRenderer</a></li><li><a href="module-src_state-validator-=_-StateValidator.html">StateValidator</a></li><li><a href="module-src_views_block-BlockView_-BlockView.html">BlockView</a></li><li><a href="module-src_views_column-resize-handle-IE-ColumnResizeHandleIE_-ColumnResizeHandleIE.html">ColumnResizeHandleIE</a></li><li><a href="module-src_views_column-resize-handle-ColumnResizeHandle_-ColumnResizeHandle.html">ColumnResizeHandle</a></li><li><a href="module-src_views_column-ColumnView_-ColumnView.html">ColumnView</a></li><li><a href="module-src_views_content-ContentView_-ContentView.html">ContentView</a></li><li><a href="module-src_views_import-ImportView_-ImportView.html">ImportView</a></li><li><a href="module-src_views_layout-LayoutView_-LayoutView.html">LayoutView</a></li><li><a href="module-src_views_move-handle-MoveHandle_-MoveHandle.html">MoveHandle</a></li><li><a href="module-src_views_publish-PublishView_-PublishView.html">PublishView</a></li><li><a href="module-src_views_vspace-flyout-=_-VspaceFlyoutView.html">VspaceFlyoutView</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Sep 12 2016 15:47:20 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
